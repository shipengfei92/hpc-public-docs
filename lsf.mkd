% LSF使用方法
% 上海交通大学高性能计算中心\
<http://hpc.sjtu.edu.cn>
% 2013年8月19日 更新

这份文档将指导您通过LSF提交和管理作业。文档包含了使用LSF提交、查看、删除作业的相关内容。

遵循文档的操作规范和反馈方法，将帮助您顺利完成工作。也欢迎大家对文档内容提出建议，谢谢！

作业提交
======

设置环境变量
------

您使用LSF，应设置相应的环境变量：

Csh用户，登录系统后执行

	source /export/lsf/cshrc.lsf

Bash用户，登录系统后执行

	./export/lsf/conf/profile.lsf

您也可以将其写入.cshrc或.bashrc文件，则登录后就自动设置了相应的环境变量。

提交作业
------

LSF使用bsub提交作业。

bsub命令的常见用法：

	bsub -n Z -q QUEUENAME -i INPUTFILE -o OUTPUTFILE COMMAND

其中：Z代表了提交作业需要的cpu数目，-q指定作业提交的队列。如果不添加-q选项，系统将把作业提交到默认的作业队列。INPUTFILE代表程序需要读入的文件名，OUTPUTFILE代表一个文件，作业提交后的标准输出信息将会保存在OUTPUTFILE这个文件中。

对于串行程序，COMMAND可以直接使用您的程序名

例如，对一个12小时内完成的串行作业mytest的提交方式为：

	bsub -n 1 -q QN_Norm -o mytest.out ./mytest

对于并行作业，COMMAND的格式为“```-a mpich_gm mpirun.lsf 程序名```”

例如，对一个12小时内完成的，且使用16个CPU的并行作业mytest，其提交方式为：

	bsub -n 16 -q QN_Norm -o mytest.out -a mpich_gm mpirun.lsf ./mytest

使用脚本提交作业
------

bsub命令可以使用输入脚本多次提交具有相同参数的作业，其格式为：

	#BSUB -n Z
	#BSUB -q QUEUENAME
	#BSUB -o OUTPUTFILE
	COMMAND

该脚本的参数与命令行“```bsub -n Z -q QUEUENAME -o OUTPUTFILE COMMAND```”相同，提交的方法为“```bsub<脚本名```”。

例如要提交一个12小时内完成，且需要16个CPU的并行作业mytest，可以编写脚本bsub.scriptfile:

	#BSUB -n 16
	#BSUB -q QN_Norm
	#BSUB -o mytest.out
	-a mpich_gm mpirun.lsf ./mytest

作业的提交方法为：```bsub<bsub.scriptfile```

作业查看与删除
======

几个常用的命令:

* ```bjobs			检查提交作业的状态```
* ```bjobs -w		以宽格式来显示作业的信息```
* ```bjobs -r		显示正在运行的作业```
* ```bjobs -a		显示所有的作业```
* ```bjobs -p		显示等待运行的作业和等待的原因```
* ```bjobs -s		显示正在挂起的作业和挂起的原因```
* ```bjobs -l		显示该作业的所有信息```
* ```bhist			显示作业的历史情况```
* ```bhist <jobid>	显示指定作业的历史情况```
* ```bkill			删除不需要的作业```
* ```bkill <jobid>	删除指定的作业```
* ```bkill -r <jobid>```
* ```bpeek			当作也正在运行时，显示它的标准输出，监视作业运行```
* ```bpeek <jobid>	查看指定作业的标准输出```
* ```bqueues		显示队列信息```
* ```bqueues -l <queue name>```
* ```lsload			显示各节点的负载信息```
* ```lsload <hostname>```

